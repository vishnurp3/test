@Configuration
public class DataSourceApplicationConfig {

    // ----------------------------------------------------------------------
    // 1Ô∏è‚É£  DataSourceProperties for the main datasource
    // ----------------------------------------------------------------------
    @Bean
    @ConfigurationProperties("spring.datasource")
    public DataSourceProperties mainDsProperties() {
        return new DataSourceProperties();
    }

    // ----------------------------------------------------------------------
    // 2Ô∏è‚É£  DataSourceProperties for the CDF datasource
    // ----------------------------------------------------------------------
    @Bean
    @ConfigurationProperties("spring.datasource.cdf")
    public DataSourceProperties cdfDsProperties() {
        return new DataSourceProperties();
    }

    // ----------------------------------------------------------------------
    // 3Ô∏è‚É£  Main datasource bean
    // ----------------------------------------------------------------------
    @Bean(name = "dataSource")
    public DataSource dataSource() {

        // Build datasource from properties (URL, username, password, driver)
        BasicDataSource ds = new BasicDataSource();
        DataSourceProperties props = mainDsProperties();

        ds.setUrl(props.getUrl());
        ds.setUsername(props.getUsername());
        ds.setPassword(props.getPassword());
        ds.setDriverClassName(props.getDriverClassName());

        // If you have connection pool tuning builder
        UserDefinedDataSourceBuilder.addConnectionPoolProperties(
                ds,
                dataSourcePoolProperties()
        );

        return ds;
    }

    // If you already have this in your old config
    @Bean
    @ConfigurationProperties("spring.datasource.pool")
    public Map<String, Object> dataSourcePoolProperties() {
        return new HashMap<>();
    }

    // ----------------------------------------------------------------------
    // 4Ô∏è‚É£  CDF datasource bean (override only username)
    // ----------------------------------------------------------------------
    @Bean(name = "cdfDataSource")
    @Primary
    public DataSource cdfDataSource() {

        BasicDataSource ds = new BasicDataSource();
        DataSourceProperties props = cdfDsProperties();

        ds.setUrl(props.getUrl());

        // üî• override username manually
        ds.setUsername("my_custom_username");

        // üü¢ password still comes from Vault automatically
        ds.setPassword(props.getPassword());

        ds.setDriverClassName(props.getDriverClassName());

        // Pool config (if needed)
        UserDefinedDataSourceBuilder.addConnectionPoolProperties(
                ds,
                cdfDataSourcePoolProperties()
        );

        return ds;
    }

    @Bean
    @ConfigurationProperties("spring.datasource.cdf.pool")
    public Map<String, Object> cdfDataSourcePoolProperties() {
        return new HashMap<>();
    }

    // ----------------------------------------------------------------------
    // 5Ô∏è‚É£  JdbcTemplates
    // ----------------------------------------------------------------------
    @Bean(name = "jdbcTemplate")
    public JdbcTemplate jdbcTemplate() {
        return new JdbcTemplate(dataSource());
    }

    @Bean(name = "cdfJdbcTemplate")
    public JdbcTemplate cdfJdbcTemplate() {
        return new JdbcTemplate(cdfDataSource());
    }
}
