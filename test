@PostMapping(
        value = "/run/{modelType}/{modelCode}",
        consumes = MediaType.MULTIPART_FORM_DATA_VALUE,
        produces = MediaType.TEXT_PLAIN_VALUE
)
@ApiOperation(
        value = "Generate migration SQL scripts (plain text preview)",
        notes = "Pass parameters as request params and optionally upload Parent Quest CSV."
)
public ResponseEntity<String> runMigration(
        @ApiParam(value = "Model type (CRS or CTP)", required = true)
        @PathVariable String modelType,

        @ApiParam(value = "Model code (ex: SRI, SMF, SRS, etc.)", required = true)
        @PathVariable String modelCode,

        @ApiParam(value = "Jira ticket (ex: WCR-15203)", required = true)
        @RequestParam String jira,

        @ApiParam(value = "Upgrade type (MINOR or MAJOR)", required = false)
        @RequestParam(required = false) String upgradeType,

        @ApiParam(value = "Recipe name", required = true)
        @RequestParam String recipe,

        @ApiParam(value = "Parent Quest CSV file", required = false)
        @RequestPart(required = false, value = "parentQuestCsv") MultipartFile parentQuestCsv
) {
    List<ParentQuestCsvRecord> csvRecords =
            parentQuestCsvParser.parse(parentQuestCsv);

    // Build MigrationRequest manually (since JSON is removed)
    MigrationRequest req = new MigrationRequest();
    req.setModelType(modelType);
    req.setModelCode(modelCode);
    req.setJira(jira);
    req.setUpgradeType(upgradeType);
    req.setRecipe(recipe);
    // rootOutputFolder removed as requested â€” generator will default it internally

    List<GeneratedSqlFile> files =
            migrationEngine.generateScripts(req, csvRecords);

    String body = responseFormatter.formatAsPreviewText(files);

    return ResponseEntity
            .ok()
            .contentType(MediaType.TEXT_PLAIN)
            .body(body);
}
