import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.jasypt.encryption.StringEncryptor;
import org.springframework.stereotype.Component;
import org.springframework.boot.CommandLineRunner;

@Slf4j
@Component
@RequiredArgsConstructor
public class JasyptStartupLogger implements CommandLineRunner {

    private final StringEncryptor jasyptStringEncryptor;

    @Override
    public void run(String... args) {
        // Example plain text to encrypt
        String samplePlain = "mySecretToEncrypt";

        // Encrypt using same config/algorithm as your app
        String encrypted = jasyptStringEncryptor.encrypt(samplePlain);
        log.info("Plain           : {}", samplePlain);
        log.info("Encrypted (raw) : {}", encrypted);
        log.info("Store as        : ENC({})", encrypted);

        // Decrypt back to verify
        String decrypted = jasyptStringEncryptor.decrypt(encrypted);
        log.info("Decrypted back  : {}", decrypted);

        // Optionally: decrypt an existing value you paste in
        String existingEnc = "ENC(pasteYourExistingCipherHere)";
        String cleaned = existingEnc.replaceFirst("^ENC\\(", "")
                                    .replaceFirst("\\)$", "");
        // Wrap in try/catch so startup doesn't die if it's wrong
        try {
            String existingPlain = jasyptStringEncryptor.decrypt(cleaned);
            log.info("Existing ENC(...) decrypted to: {}", existingPlain);
        } catch (Exception e) {
            log.warn("Could not decrypt existing ENC(...) value: {}", e.getMessage());
        }
    }
}
